<!DOCTYPE html>
<html>
<head>
    <title>Super Simple Checklist</title>
    <script>
        window.onload = function() {


            window.addEventListener("click",function(event){
                tag = document.activeElement.tagName
                if(tag !== "LI" && tag !== "INPUT" && tag !== "TEXTAREA"){
                    update_checklist(event);
                }
            });
            var bind_textarea_events = function(textarea_element){
                textarea_element.addEventListener("keyup",update_checklist);
                textarea_element.addEventListener("keydown",update_checklist);
                textarea_element.addEventListener("focus",update_checklist);
            }

            var add_another_checklist_item = function(){
                var el = document.getElementById('main-checklist');
                new_textarea = document.createElement("textarea");
                new_textarea.setAttribute("placeholder", "+ Add list item");
                bind_textarea_events(new_textarea)

                new_checkbox = document.createElement("input");
                new_checkbox.setAttribute("type", "checkbox");

                new_deleter = document.createElement("div");
                new_deleter.className = "deleter"

                new_deleter.addEventListener("click",function(){
                    this.parentNode.parentNode.removeChild(this.parentNode);
                })

                new_checklist_item = document.createElement("li")
                new_checklist_item.appendChild(new_checkbox);
                new_checklist_item.appendChild(new_textarea);
                new_checklist_item.appendChild(new_deleter);
                el.appendChild(new_checklist_item);
            }

            var update_checklist = function(event){
                var all_checklist_items = document.getElementsByTagName('textarea')
                if(event.keyCode == 13){
                    event.preventDefault();
                    this.value = this.value.replace(/\n/g,"")
                    focus_next = false
                    for (var i = 0; i < all_checklist_items.length; i++) {
                        if(all_checklist_items[i] === this){
                            focus_next = true
                        } else if (focus_next){
                            all_checklist_items[i].focus()
                            focus_next = false;
                            break
                        }
                    }
                }

                if(this.tagName === 'TEXTAREA'){
                    this.style.height = "17px";
                    if((this.scrollHeight - 33) % 23 === 0){
                        this.style.height = this.scrollHeight - 10 + "px"
                    }
                };

                add_another_checklist_item()

                var items_to_delete = []
                for (var i = 1; i <= all_checklist_items.length; i++) {
                    var item = all_checklist_items[i-1]
                    if (item.value.length < 1
                        && i != all_checklist_items.length
                        && i != 1
                        && item != document.activeElement) {
                            items_to_delete.push(item)
                    }
                }
                for (var i = 0; i < items_to_delete.length; i++) {
                    items_to_delete[i].parentNode.parentNode.removeChild(items_to_delete[i].parentNode)
                }
            }

            var all_textareas = document.getElementsByTagName('textarea')


            for (var i = 0; i < all_textareas.length; i++) {
                bind_textarea_events(all_textareas[i])
            }

            add_another_checklist_item()

            if(event.keyCode == 13){
                return false
            }
        }
    </script>
    <style>
        * {
            font-family: "Trebuchet MS", Helvetica, sans-serif;
            font-size: 20px;
            color: #555;
        }

        h1,h2,h3,h4,h5,h6 {
            font-family: "Palatino Linotype", "Book Antiqua", Palatino, serif;
            color: #222;
        }

        h1 {
            text-align: center;
            font-size: 40px;
            margin-top: 80px;
        }

        .main-container {
            margin: auto;
            margin-top: 60px;
            width: 40%;
        }

        #checklist-body {

        }

        ul {
            padding: 0px;
        }

        li {
            padding-top: 5px;
            padding-bottom: 0px;
            list-style-type: none;
            border-bottom: 1px dashed #bbb;
            padding-left: 2px;
        }

        li:first-child {
            padding-top: 0px;
        }

        li:last-child {
            border-bottom: none;
        }

        li:last-child div, li:last-child input[type="checkbox"] {
            display: none;
        }

        li textarea {
            padding-left: 25px;
            border: 0px;
            width: Calc(93% - 27px);
            margin-left: 27px;
            padding: 5px;
            resize: none;
            height: 1em;
            outline: none;
            overflow: default;
        }

        textarea::-webkit-input-placeholder { color:transparent; }
        textarea:-moz-placeholder { color:transparent; }
        textarea::-moz-placeholder { color:transparent; }
        textarea:-ms-input-placeholder { color:transparent; }

        li:last-child textarea::-webkit-input-placeholder { color:#bbb; }
        li:last-child textarea:-moz-placeholder { color:#bbb; }
        li:last-child textarea::-moz-placeholder { color:#bbb; }
        li:last-child textarea:-ms-input-placeholder { color:#bbb; }

        li:last-child textarea {
            padding-left: 25px;
        }

        li div, li input[type="checkbox"] {
            display: inline-block;
            width: 5%;
            position: relative;
        }

        li input[type="checkbox"] {
            -webkit-appearance: none;
            width: 19px;
            height: 19px;
            border: 2px solid #222;
            color: #222;
            border-radius: 2px;
            position: absolute;
            margin-top: 6px;
            outline: none;
        }

        li input[type="checkbox"]:checked:after {
            content:"✔";
            font-size: 20px;
            text-shadow: 3px 0px 0px white, 1px -1px 0px white, 1px -3px 0px white;
            position: absolute;
            margin-top: -5px;
        }

        li div.deleter:after {
            position: absolute;
            top:-25px;
            content:'✖';
            color: #bbb;
        }
    </style>
</head>
<body>
    <h1>Super Simple Checklist</h1>
    <div class="main-container" id="checklist-body">
        <ul id="main-checklist">
            <li><input type="checkbox"><textarea style="height: 23px;">Make a checklist!</textarea><div class="deleter"></div></li>
        </ul>
    </div>
</body>
</html>